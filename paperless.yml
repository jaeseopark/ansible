- name: Determine paperless target host
  hosts: localhost
  gather_facts: false
  vars:
    paperless_app_object: "{{ apps | selectattr('name', 'equalto', 'paperless') | first }}"
  tasks:
    - name: Set target host for paperless
      add_host:
        name: "{{ paperless_app_object.host }}"
        groups: paperless_target

- name: Paperless
  hosts: paperless_target
  vars:
    app_path: "/app/paperless"
    restic_repository_name: "paperless"
  roles:
    - paperless
    - restic
