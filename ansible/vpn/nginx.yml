---
- hosts: vpnservers
  vars:
    apps:
      - name: jellyfin
        ip: "{{ hostvars[jellyfin_host].wg_ip }}"
        port: "{{ jellyfin_port }}"
      - name: paperless
        ip: "{{ hostvars[paperless_host].wg_ip }}"
        port: "{{ paperless_port }}"
        additional_config: client_max_body_size 1024m;
  tasks:
    - name: Ensure nginx is installed
      package:
        name: nginx
        state: present
    - name: Ensure nginx is not running
      service:
        name: nginx
        state: stopped
    - name: Copy nginx config from the host manchine
      template:
        src: nginx.conf.j2
        dest: /etc/nginx/sites-enabled/default.conf
    - name: start nginx
      service:
        name: nginx
        state: started
